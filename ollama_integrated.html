<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üåæ Krishi Mitra ‚Äì AI SMART KHETI's Farming Assistant</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}
body{background:linear-gradient(135deg,#2ecc71,#27ae60);min-height:100vh;display:flex;justify-content:center;align-items:center;padding:20px}
.chatbot-container{width:100%;max-width:400px;height:80vh;background:white;border-radius:20px;box-shadow:0 20px 50px rgba(0,0,0,.3);display:flex;flex-direction:column;overflow:hidden}
.chat-header{background:linear-gradient(135deg,#2ecc71,#27ae60);color:#fff;padding:20px;text-align:center;position:relative}
.language-switcher{position:absolute;top:15px;right:15px}
.lang-btn{background:rgba(255,255,255,.2);color:#fff;border:none;padding:8px 15px;border-radius:15px;cursor:pointer;font-size:12px;backdrop-filter:blur(10px);transition:.3s}
.lang-btn.active{background:rgba(255,255,255,.4);transform:scale(1.1)}
.chat-messages{flex:1;padding:20px;overflow-y:auto;background:#f8f9fa}
.message{margin:12px 0;padding:12px 16px;border-radius:18px;max-width:85%;word-wrap:break-word;line-height:1.5;animation:fadeIn .3s ease;white-space: pre-line;}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.bot-message{background:#e3f2fd;border-bottom-left-radius:5px;align-self:flex-start;border:1px solid #bbdefb}
.user-message{background:linear-gradient(135deg,#3498db,#2980b9);color:#fff;border-bottom-right-radius:5px;margin-left:auto;box-shadow:0 2px 5px rgba(52,152,219,.3)}
.quick-buttons{display:flex;flex-wrap:wrap;gap:8px;padding:15px;background:#fff;border-top:1px solid #ecf0f1}
.quick-btn{background:linear-gradient(135deg,#e74c3c,#c0392b);color:#fff;border:none;padding:10px 16px;border-radius:20px;cursor:pointer;font-size:13px;transition:.3s;box-shadow:0 2px 5px rgba(231,76,60,.3)}
.quick-btn:hover{transform:translateY(-2px);box-shadow:0 4px 8px rgba(231,76,60,.4)}
.chat-input-container{display:flex;padding:15px;background:#fff;border-top:1px solid #ecf0f1}
.chat-input{flex:1;padding:12px 20px;border:2px solid #ecf0f1;border-radius:25px;margin-right:10px;font-size:14px;outline:none;transition:.3s}
.chat-input:focus{border-color:#3498db}
.send-btn{background:linear-gradient(135deg,#2ecc71,#27ae60);color:#fff;border:none;padding:12px 25px;border-radius:25px;cursor:pointer;transition:.3s;box-shadow:0 2px 5px rgba(46,204,113,.3)}
.send-btn:hover{transform:scale(1.05);box-shadow:0 4px 8px rgba(46,204,113,.4)}
.typing-indicator{display:none;padding:10px 16px;background:#e3f2fd;border-radius:18px;border-bottom-left-radius:5px;max-width:80px;margin:10px 0}
.typing-dots{display:flex;gap:4px}
.typing-dots span{width:8px;height:8px;background:#3498db;border-radius:50%;animation:typing 1.4s infinite}
.typing-dots span:nth-child(2){animation-delay:.2s}
.typing-dots span:nth-child(3){animation-delay:.4s}
@keyframes typing{0%,60%,100%{transform:translateY(0)}30%{transform:translateY(-5px)}}
.api-status{position:absolute;top:15px;left:15px;font-size:10px;background:rgba(255,255,255,.2);padding:4px 8px;border-radius:10px;backdrop-filter:blur(10px)}
.scrollbar::-webkit-scrollbar{width:6px}
.scrollbar::-webkit-scrollbar-thumb{background:#3498db;border-radius:3px}

/* Header text elements */
.header-title { font-size: 1.5em; margin-bottom: 5px; }
.header-subtitle { font-size: 0.9em; opacity: 0.9; margin-bottom: 3px; }
.header-tagline { font-size: 0.8em; opacity: 0.8; }

/* Solution styling */
.solution-section { margin: 10px 0; }
.solution-title { font-weight: bold; color: #2c3e50; margin-bottom: 8px; font-size: 1.1em; }
.solution-step { margin: 8px 0; padding-left: 20px; position: relative; }
.solution-step:before { content: "‚Ä¢"; position: absolute; left: 8px; color: #2ecc71; font-weight: bold; }
.emergency-alert { background: #ffebee; border-left: 4px solid #e53935; padding: 10px; margin: 10px 0; border-radius: 4px; }
.warning-alert { background: #fff3e0; border-left: 4px solid #ff9800; padding: 10px; margin: 10px 0; border-radius: 4px; }
.success-alert { background: #e8f5e8; border-left: 4px solid #4caf50; padding: 10px; margin: 10px 0; border-radius: 4px; }

/* Ollama status */
.ollama-status { position: absolute; top: 15px; left: 15px; font-size: 10px; background: rgba(255,255,255,.2); padding: 4px 8px; border-radius: 10px; backdrop-filter: blur(10px); }
.ollama-connected { background: rgba(46, 204, 113, 0.3); }
.ollama-disconnected { background: rgba(231, 76, 60, 0.3); }
</style>
</head>
<body>
<div class="chatbot-container">
<div class="chat-header">
<div class="ollama-status" id="ollamaStatus">üî¥ Ollama Offline</div>
<h2 class="header-title" id="headerTitle">üåæ Krishi Mitra</h2>
<p class="header-subtitle" id="headerSubtitle">SMART KHETI's</p>
<p class="header-tagline" id="headerTagline">Problem-Solving Farming Expert</p>
<div class="language-switcher">
<button class="lang-btn active" onclick="setLanguage('en',event)">EN</button>
<button class="lang-btn" onclick="setLanguage('hi',event)">‡§π‡§ø‡§Ç‡§¶‡•Ä</button>
</div>
</div>
<div class="chat-messages scrollbar" id="chatMessages">
<div class="message bot-message">üëã Namaste! I'm Krishi Mitra - your farming problem solver!

Tell me any farming issue you're facing, and I'll provide detailed step-by-step solutions! üå±</div>
</div>
<div class="typing-indicator" id="typingIndicator">
<div class="typing-dots"><span></span><span></span><span></span></div>
</div>
<div class="quick-buttons" id="quickButtons"></div>
<div class="chat-input-container">
<input type="text" class="chat-input" id="userInput" placeholder="Describe your farming problem..." onkeypress="handleKeyPress(event)">
<button class="send-btn" onclick="sendMessage()">Send</button>
</div>
</div>

<script>
let currentLanguage = 'en';
let useOllama = false;

// Check if Ollama is available
async function checkOllama() {
    try {
        const response = await fetch('http://localhost:11434/api/tags', {
            method: 'GET',
            headers: {'Content-Type': 'application/json'}
        });
        
        if (response.ok) {
            useOllama = true;
            document.getElementById('ollamaStatus').textContent = "üü¢ Ollama Online";
            document.getElementById('ollamaStatus').classList.add('ollama-connected');
            document.getElementById('ollamaStatus').classList.remove('ollama-disconnected');
            console.log("Ollama is connected!");
        }
    } catch (error) {
        useOllama = false;
        document.getElementById('ollamaStatus').textContent = "üî¥ Ollama Offline";
        document.getElementById('ollamaStatus').classList.add('ollama-disconnected');
        document.getElementById('ollamaStatus').classList.remove('ollama-connected');
        console.log("Ollama not available, using local knowledge base");
    }
}

// Ollama API call
async function callOllama(userMessage) {
    if (!useOllama) return null;
    
    try {
        const prompt = `You are Krishi Mitra - a helpful farming expert for Indian farmers. Answer in ${currentLanguage === 'en' ? 'English' : 'Hindi and English'}.
        
User Question: ${userMessage}

Provide practical, step-by-step farming advice. Be specific and actionable. Focus on:
- Immediate solutions
- Long-term prevention
- Organic methods first
- Cost-effective approaches
- Local Indian farming context

Answer:`;
        
        const response = await fetch('http://localhost:11434/api/generate', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                model: 'llama2',
                prompt: prompt,
                stream: false,
                options: {
                    temperature: 0.7,
                    top_p: 0.9,
                    num_predict: 500
                }
            })
        });
        
        if (!response.ok) throw new Error('Ollama response error');
        
        const data = await response.json();
        return data.response;
        
    } catch (error) {
        console.log('Ollama error:', error);
        useOllama = false;
        document.getElementById('ollamaStatus').textContent = "üî¥ Ollama Error";
        return null;
    }
}

// Bilingual header texts
const headerTexts = {
    en: {
        title: "üåæ Krishi Mitra",
        subtitle: "SMART KHETI's",
        tagline: "Problem-Solving Farming Expert",
        inputPlaceholder: "Describe your farming problem..."
    },
    hi: {
        title: "üåæ ‡§ï‡•É‡§∑‡§ø ‡§Æ‡§ø‡§§‡•ç‡§∞",
        subtitle: "‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§ñ‡•á‡§§‡•Ä", 
        tagline: "‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ-‡§∏‡§Æ‡§æ‡§ß‡§æ‡§® ‡§ï‡•É‡§∑‡§ø ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û",
        inputPlaceholder: "‡§Ö‡§™‡§®‡•Ä ‡§ï‡•É‡§∑‡§ø ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§¨‡§§‡§æ‡§è‡§Ç..."
    }
};

// SMART PROBLEM-SOLVING KNOWLEDGE BASE
const farmingSolutions = {
    en: {
        welcome: `üëã Namaste! I'm Krishi Mitra - Your Farming Problem Solver! üåæ

I specialize in diagnosing and solving real farming problems:

üö® Emergency Issues: Waterlogging, pest outbreaks, disease spread
üåßÔ∏è Weather Problems: Drought, floods, unseasonal rains
üå± Crop Issues: Yellow leaves, poor growth, low yield
üêõ Pest & Diseases: Identification and organic control
üíß Water Management: Too much/little water, irrigation issues

Just describe your problem - I'll provide step-by-step solutions!`,

        quickButtons: [
            {text: "üíß Waterlogging", query: "too much water in my field waterlogging"},
            {text: "üçÇ Yellow Leaves", query: "tomato yellow leaves problem"},
            {text: "üêõ Pest Attack", query: "insects eating my crops"},
            {text: "üå± Poor Growth", query: "crops not growing properly"},
            {text: "üåßÔ∏è Drought", query: "no rain water shortage"},
            {text: "üí∞ Low Yield", query: "low production less yield"}
        ],

        // SMART PROBLEM DETECTION AND SOLUTIONS
        problemKeywords: {
            'waterlogging': {
                problem: "Waterlogging/Excess Water in Field",
                severity: "HIGH",
                immediate: "Stop irrigation immediately and assess damage",
                steps: [
                    "üîÑ Create emergency drainage channels to redirect excess water",
                    "üï≥Ô∏è Dig small trenches (1-2 feet deep) between crop rows",
                    "üåæ For established crops, gently loosen soil around roots to improve aeration",
                    "üíä Apply Trichoderma or Carbendazim to prevent root rot",
                    "üìÖ Wait 3-5 days before next irrigation, monitor plant health daily"
                ],
                prevention: [
                    "Install proper drainage system with 1% slope",
                    "Raised bed cultivation for water-sensitive crops",
                    "Add organic matter to improve soil structure",
                    "Avoid heavy irrigation before predicted rains"
                ],
                warning: "Waterlogged conditions can kill crops within 48-72 hours. Act immediately!"
            },

            'yellow leaves': {
                problem: "Yellow Leaves/Nutrient Deficiency",
                severity: "MEDIUM",
                immediate: "Identify pattern - old leaves or new leaves?",
                diagnosis: [
                    "Old Leaves Yellow: Nitrogen deficiency - Apply urea or organic nitrogen",
                    "Young Leaves Yellow: Iron deficiency - Apply FeSO4 solution",
                    "Yellow Between Veins: Magnesium deficiency - Apply Epsom salt",
                    "Overall Yellowing: Overwatering or poor drainage"
                ],
                steps: [
                    "üß™ Soil Test: Check pH and nutrient levels immediately",
                    "üåø Quick Fix: Foliar spray with NPK 19:19:19 for immediate nutrient supply",
                    "üíß Water Management: Adjust irrigation based on soil moisture",
                    "üå± Long-term: Add well-decomposed compost and practice crop rotation"
                ]
            },

            'pest attack': {
                problem: "Pest Infestation",
                severity: "HIGH",
                immediate: "Identify pest type and extent of damage",
                identification: [
                    "üêõ Chewing Pests (caterpillars, beetles): Neem oil + soap spray",
                    "ü¶ü Sucking Pests (aphids, whiteflies): Imidacloprid or neem-based insecticides",
                    "üêå Soil Pests (termites, cutworms): Chlorpyriphos soil application",
                    "üï∑Ô∏è Mites: Wettable sulfur or abamectin spray"
                ],
                steps: [
                    "üîç Inspection: Check undersides of leaves and soil for pests",
                    "üåø Organic First: Neem oil (5ml/L) + soap solution spray every 3 days",
                    "üêû Biological Control: Release ladybugs for aphids",
                    "üíä Chemical (if severe): Use specific insecticides as last resort",
                    "üõ°Ô∏è Prevention: Clean cultivation, remove weeds, use yellow sticky traps"
                ]
            },

            'drought': {
                problem: "Water Scarcity/Drought Conditions",
                severity: "HIGH",
                immediate: "Implement water conservation measures immediately",
                steps: [
                    "üíß Water Saving: Switch to drip irrigation or use pitcher irrigation",
                    "üåø Mulching: Apply 3-4 inch thick organic mulch around plants",
                    "üïí Timing: Water early morning (4-6 AM) to reduce evaporation",
                    "üåæ Crop Selection: Grow drought-resistant varieties for next season",
                    "üåßÔ∏è Rainwater: Create farm ponds and water harvesting structures"
                ],
                emergency: [
                    "Prioritize water for critical growth stages",
                    "Use hydrogel polymers to retain soil moisture",
                    "Consider partial shade for sensitive crops"
                ]
            },

            'poor growth': {
                problem: "Stunted Growth/Poor Plant Development",
                severity: "MEDIUM",
                diagnosis: [
                    "Check Roots: Healthy roots = white and spread out",
                    "Soil Quality: Compacted soil needs aeration",
                    "Nutrient Balance: Test NPK levels in soil",
                    "Water Logging: Yellow leaves + wet soil = drainage issue"
                ],
                steps: [
                    "üå± Soil Aeration: Light ploughing or fork cultivation",
                    "üß™ Balanced Nutrition: Apply complete NPK fertilizer based on soil test",
                    "üíß Proper Irrigation: Maintain consistent soil moisture",
                    "üåø Organic Matter: Add vermicompost or FYM to improve soil health",
                    "üîç Pest Check: Look for nematodes or soil-borne diseases"
                ]
            }
        },

        defaultResponse: `üîç I understand you're facing a farming issue. Let me help you solve it!

To give you the best solution, please tell me:

üå± What crop are you growing?
üö® Specific symptoms you're observing?
üìÖ How long has this been happening?
üåßÔ∏è Recent weather conditions in your area?

Or describe your problem in detail like:
‚Ä¢ My tomato plants have yellow leaves and are wilting
‚Ä¢ There's too much water in my rice field after rains
‚Ä¢ Insects are eating my cabbage leaves
‚Ä¢ My wheat crop is not growing properly`

    },

    hi: {
        welcome: `üëã ‡§®‡§Æ‡§∏‡•ç‡§§‡•á! ‡§Æ‡•à‡§Ç ‡§ï‡•É‡§∑‡§ø ‡§Æ‡§ø‡§§‡•ç‡§∞ ‡§π‡•Ç‡§Ç - ‡§Ü‡§™‡§ï‡§æ ‡§ï‡•É‡§∑‡§ø ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§®‡§ï‡§∞‡•ç‡§§‡§æ! üåæ

‡§Æ‡•à‡§Ç ‡§µ‡§æ‡§∏‡•ç‡§§‡§µ‡§ø‡§ï ‡§ï‡•É‡§∑‡§ø ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ‡§ì‡§Ç ‡§ï‡§æ ‡§®‡§ø‡§¶‡§æ‡§® ‡§î‡§∞ ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§® ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û ‡§π‡•Ç‡§Ç:

üö® ‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤‡•Ä‡§® ‡§Æ‡•Å‡§¶‡•ç‡§¶‡•á: ‡§ú‡§≤‡§≠‡§∞‡§æ‡§µ, ‡§ï‡•Ä‡§ü ‡§™‡•ç‡§∞‡§ï‡•ã‡§™, ‡§∞‡•ã‡§ó ‡§´‡•à‡§≤‡§æ‡§µ
üåßÔ∏è ‡§Æ‡•å‡§∏‡§Æ ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡•Ä ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ‡§è‡§Ç: ‡§∏‡•Ç‡§ñ‡§æ, ‡§¨‡§æ‡§¢‡§º, ‡§Ö‡§∏‡§Æ‡§Ø ‡§µ‡§∞‡•ç‡§∑‡§æ
üå± ‡§´‡§∏‡§≤ ‡§Æ‡•Å‡§¶‡•ç‡§¶‡•á: ‡§™‡•Ä‡§≤‡•Ä ‡§™‡§§‡•ç‡§§‡§ø‡§Ø‡§æ‡§Ç, ‡§ñ‡§∞‡§æ‡§¨ ‡§µ‡§ø‡§ï‡§æ‡§∏, ‡§ï‡§Æ ‡§â‡§™‡§ú
üêõ ‡§ï‡•Ä‡§ü ‡§î‡§∞ ‡§∞‡•ã‡§ó: ‡§™‡§π‡§ö‡§æ‡§® ‡§î‡§∞ ‡§ú‡•à‡§µ‡§ø‡§ï ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§£
üíß ‡§ú‡§≤ ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§®: ‡§¨‡§π‡•Å‡§§ ‡§Ö‡§ß‡§ø‡§ï/‡§ï‡§Æ ‡§™‡§æ‡§®‡•Ä, ‡§∏‡§ø‡§Ç‡§ö‡§æ‡§à ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ‡§è‡§Ç

‡§¨‡§∏ ‡§Ö‡§™‡§®‡•Ä ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§¨‡§§‡§æ‡§è‡§Ç - ‡§Æ‡•à‡§Ç ‡§ö‡§∞‡§£‡§¨‡§¶‡•ç‡§ß ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§® ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§∞‡•Ç‡§Ç‡§ó‡§æ!`,

        quickButtons: [
            {text: "üíß ‡§ú‡§≤‡§≠‡§∞‡§æ‡§µ", query: "‡§ñ‡•á‡§§ ‡§Æ‡•á‡§Ç ‡§¨‡§π‡•Å‡§§ ‡§ú‡•ç‡§Ø‡§æ‡§¶‡§æ ‡§™‡§æ‡§®‡•Ä ‡§ú‡§≤‡§≠‡§∞‡§æ‡§µ"},
            {text: "üçÇ ‡§™‡•Ä‡§≤‡•Ä ‡§™‡§§‡•ç‡§§‡§ø‡§Ø‡§æ‡§Ç", query: "‡§ü‡§Æ‡§æ‡§ü‡§∞ ‡§™‡•Ä‡§≤‡•Ä ‡§™‡§§‡•ç‡§§‡§ø‡§Ø‡§æ‡§Ç ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ"},
            {text: "üêõ ‡§ï‡•Ä‡§ü ‡§π‡§Æ‡§≤‡§æ", query: "‡§ï‡•Ä‡§ü ‡§´‡§∏‡§≤ ‡§ñ‡§æ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç"},
            {text: "üå± ‡§ñ‡§∞‡§æ‡§¨ ‡§µ‡§ø‡§ï‡§æ‡§∏", query: "‡§´‡§∏‡§≤ ‡§†‡•Ä‡§ï ‡§∏‡•á ‡§®‡§π‡•Ä‡§Ç ‡§¨‡§¢‡§º ‡§∞‡§π‡•Ä"},
            {text: "üåßÔ∏è ‡§∏‡•Ç‡§ñ‡§æ", query: "‡§¨‡§æ‡§∞‡§ø‡§∂ ‡§®‡§π‡•Ä‡§Ç ‡§™‡§æ‡§®‡•Ä ‡§ï‡•Ä ‡§ï‡§Æ‡•Ä"},
            {text: "üí∞ ‡§ï‡§Æ ‡§â‡§™‡§ú", query: "‡§ï‡§Æ ‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§® ‡§ï‡§Æ ‡§â‡§™‡§ú"}
        ],

        problemKeywords: {
            '‡§ú‡§≤‡§≠‡§∞‡§æ‡§µ': {
                problem: "‡§ñ‡•á‡§§ ‡§Æ‡•á‡§Ç ‡§Ö‡§§‡•ç‡§Ø‡§ß‡§ø‡§ï ‡§™‡§æ‡§®‡•Ä/‡§ú‡§≤‡§≠‡§∞‡§æ‡§µ",
                severity: "‡§â‡§ö‡•ç‡§ö",
                immediate: "‡§§‡•Å‡§∞‡§Ç‡§§ ‡§∏‡§ø‡§Ç‡§ö‡§æ‡§à ‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§ï‡•ç‡§∑‡§§‡§ø ‡§ï‡§æ ‡§Ü‡§ï‡§≤‡§® ‡§ï‡§∞‡•á‡§Ç",
                steps: [
                    "üîÑ ‡§Ö‡§§‡§ø‡§∞‡§ø‡§ï‡•ç‡§§ ‡§™‡§æ‡§®‡•Ä ‡§ï‡•ã ‡§Æ‡•ã‡§°‡§º‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§™‡§æ‡§§‡§ï‡§æ‡§≤‡•Ä‡§® ‡§ú‡§≤ ‡§®‡§ø‡§ï‡§æ‡§∏‡•Ä ‡§ö‡•à‡§®‡§≤ ‡§¨‡§®‡§æ‡§è‡§Ç",
                    "üï≥Ô∏è ‡§™‡§æ‡§®‡•Ä ‡§ï‡•á ‡§¨‡§π‡§ø‡§∞‡•ç‡§µ‡§æ‡§π ‡§ï‡•á ‡§≤‡§ø‡§è ‡§´‡§∏‡§≤ ‡§™‡§Ç‡§ï‡•ç‡§§‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•á ‡§¨‡•Ä‡§ö ‡§õ‡•ã‡§ü‡•Ä ‡§ñ‡§æ‡§á‡§Ø‡§æ‡§Ç ‡§ñ‡•ã‡§¶‡•á‡§Ç",
                    "üåæ ‡§∏‡•ç‡§•‡§æ‡§™‡§ø‡§§ ‡§´‡§∏‡§≤‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è, ‡§µ‡§æ‡§§‡§® ‡§Æ‡•á‡§Ç ‡§∏‡•Å‡§ß‡§æ‡§∞ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ú‡§°‡§º‡•ã‡§Ç ‡§ï‡•á ‡§Ü‡§∏‡§™‡§æ‡§∏ ‡§ï‡•Ä ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§ï‡•ã ‡§¢‡•Ä‡§≤‡§æ ‡§ï‡§∞‡•á‡§Ç",
                    "üíä ‡§ú‡§°‡§º ‡§∏‡§°‡§º‡§® ‡§ï‡•ã ‡§∞‡•ã‡§ï‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ü‡•ç‡§∞‡§æ‡§á‡§ï‡•ã‡§°‡§∞‡•ç‡§Æ‡§æ ‡§Ø‡§æ ‡§ï‡§æ‡§∞‡•ç‡§¨‡•á‡§Ç‡§°‡§æ‡§ú‡§ø‡§Æ ‡§≤‡§ó‡§æ‡§è‡§Ç",
                    "üìÖ ‡§Ö‡§ó‡§≤‡•Ä ‡§∏‡§ø‡§Ç‡§ö‡§æ‡§à ‡§∏‡•á ‡§™‡§π‡§≤‡•á 3-5 ‡§¶‡§ø‡§® ‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§ï‡§∞‡•á‡§Ç, ‡§¶‡•à‡§®‡§ø‡§ï ‡§™‡•å‡§ß‡•ã‡§Ç ‡§ï‡•á ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§ï‡•Ä ‡§®‡§ø‡§ó‡§∞‡§æ‡§®‡•Ä ‡§ï‡§∞‡•á‡§Ç"
                ],
                prevention: [
                    "1% ‡§¢‡§≤‡§æ‡§® ‡§ï‡•á ‡§∏‡§æ‡§• ‡§â‡§ö‡§ø‡§§ ‡§ú‡§≤ ‡§®‡§ø‡§ï‡§æ‡§∏‡•Ä ‡§™‡•ç‡§∞‡§£‡§æ‡§≤‡•Ä ‡§∏‡•ç‡§•‡§æ‡§™‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç",
                    "‡§™‡§æ‡§®‡•Ä-‡§∏‡§Ç‡§µ‡•á‡§¶‡§®‡§∂‡•Ä‡§≤ ‡§´‡§∏‡§≤‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§â‡§†‡•á ‡§π‡•Å‡§è ‡§¨‡•á‡§° ‡§ï‡•Ä ‡§ñ‡•á‡§§‡•Ä",
                    "‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§ï‡•Ä ‡§∏‡§Ç‡§∞‡§ö‡§®‡§æ ‡§Æ‡•á‡§Ç ‡§∏‡•Å‡§ß‡§æ‡§∞ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ú‡•à‡§µ‡§ø‡§ï ‡§™‡§¶‡§æ‡§∞‡•ç‡§• ‡§ú‡•ã‡§°‡§º‡•á‡§Ç",
                    "‡§Ö‡§®‡•Å‡§Æ‡§æ‡§®‡§ø‡§§ ‡§¨‡§æ‡§∞‡§ø‡§∂ ‡§∏‡•á ‡§™‡§π‡§≤‡•á ‡§≠‡§æ‡§∞‡•Ä ‡§∏‡§ø‡§Ç‡§ö‡§æ‡§à ‡§∏‡•á ‡§¨‡§ö‡•á‡§Ç"
                ],
                warning: "‡§ú‡§≤‡§≠‡§∞‡§æ‡§µ ‡§µ‡§æ‡§≤‡•Ä ‡§∏‡•ç‡§•‡§ø‡§§‡§ø‡§Ø‡§æ‡§Ç 48-72 ‡§ò‡§Ç‡§ü‡•ã‡§Ç ‡§ï‡•á ‡§≠‡•Ä‡§§‡§∞ ‡§´‡§∏‡§≤‡•ã‡§Ç ‡§ï‡•ã ‡§Æ‡§æ‡§∞ ‡§∏‡§ï‡§§‡•Ä ‡§π‡•à‡§Ç‡•§ ‡§§‡•Å‡§∞‡§Ç‡§§ ‡§ï‡§æ‡§∞‡•ç‡§∞‡§µ‡§æ‡§à ‡§ï‡§∞‡•á‡§Ç!"
            },

            '‡§™‡•Ä‡§≤‡•Ä ‡§™‡§§‡•ç‡§§‡§ø‡§Ø‡§æ‡§Ç': {
                problem: "‡§™‡•Ä‡§≤‡•Ä ‡§™‡§§‡•ç‡§§‡§ø‡§Ø‡§æ‡§Ç/‡§™‡•ã‡§∑‡§ï ‡§§‡§§‡•ç‡§µ ‡§ï‡§Æ‡•Ä",
                severity: "‡§Æ‡§ß‡•ç‡§Ø‡§Æ",
                immediate: "‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§ï‡•Ä ‡§™‡§π‡§ö‡§æ‡§® ‡§ï‡§∞‡•á‡§Ç - ‡§™‡•Å‡§∞‡§æ‡§®‡•Ä ‡§™‡§§‡•ç‡§§‡§ø‡§Ø‡§æ‡§Ç ‡§Ø‡§æ ‡§®‡§à ‡§™‡§§‡•ç‡§§‡§ø‡§Ø‡§æ‡§Ç?",
                diagnosis: [
                    "‡§™‡•Å‡§∞‡§æ‡§®‡•Ä ‡§™‡§§‡•ç‡§§‡§ø‡§Ø‡§æ‡§Ç ‡§™‡•Ä‡§≤‡•Ä: ‡§®‡§æ‡§á‡§ü‡•ç‡§∞‡•ã‡§ú‡§® ‡§ï‡§Æ‡•Ä - ‡§Ø‡•Ç‡§∞‡§ø‡§Ø‡§æ ‡§Ø‡§æ ‡§ú‡•à‡§µ‡§ø‡§ï ‡§®‡§æ‡§á‡§ü‡•ç‡§∞‡•ã‡§ú‡§® ‡§≤‡§ó‡§æ‡§è‡§Ç",
                    "‡§Ø‡•Å‡§µ‡§æ ‡§™‡§§‡•ç‡§§‡§ø‡§Ø‡§æ‡§Ç ‡§™‡•Ä‡§≤‡•Ä: ‡§Ü‡§Ø‡§∞‡§® ‡§ï‡§Æ‡•Ä - FeSO4 ‡§ò‡•ã‡§≤ ‡§≤‡§ó‡§æ‡§è‡§Ç",
                    "‡§®‡§∏‡•ã‡§Ç ‡§ï‡•á ‡§¨‡•Ä‡§ö ‡§™‡•Ä‡§≤‡§æ: ‡§Æ‡•à‡§ó‡•ç‡§®‡•Ä‡§∂‡§ø‡§Ø‡§Æ ‡§ï‡§Æ‡•Ä - ‡§è‡§™‡•ç‡§∏‡§Æ ‡§®‡§Æ‡§ï ‡§≤‡§ó‡§æ‡§è‡§Ç",
                    "‡§∏‡§Æ‡§ó‡•ç‡§∞ ‡§™‡•Ä‡§≤‡§æ‡§™‡§®: ‡§Ö‡§ß‡§ø‡§ï ‡§™‡§æ‡§®‡•Ä ‡§Ø‡§æ ‡§ñ‡§∞‡§æ‡§¨ ‡§ú‡§≤ ‡§®‡§ø‡§ï‡§æ‡§∏‡•Ä"
                ],
                steps: [
                    "üß™ ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£: ‡§§‡•Å‡§∞‡§Ç‡§§ pH ‡§î‡§∞ ‡§™‡•ã‡§∑‡§ï ‡§§‡§§‡•ç‡§µ ‡§∏‡•ç‡§§‡§∞ ‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç",
                    "üåø ‡§§‡•ç‡§µ‡§∞‡§ø‡§§ ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§®: ‡§§‡§§‡•ç‡§ï‡§æ‡§≤ ‡§™‡•ã‡§∑‡§ï ‡§Ü‡§™‡•Ç‡§∞‡•ç‡§§‡§ø ‡§ï‡•á ‡§≤‡§ø‡§è NPK 19:19:19 ‡§ï‡•á ‡§∏‡§æ‡§• ‡§™‡§∞‡•ç‡§£ ‡§∏‡•ç‡§™‡•ç‡§∞‡•á",
                    "üíß ‡§ú‡§≤ ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§®: ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§ï‡•Ä ‡§®‡§Æ‡•Ä ‡§ï‡•á ‡§Ü‡§ß‡§æ‡§∞ ‡§™‡§∞ ‡§∏‡§ø‡§Ç‡§ö‡§æ‡§à ‡§∏‡§Æ‡§æ‡§Ø‡•ã‡§ú‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç",
                    "üå± ‡§¶‡•Ä‡§∞‡•ç‡§ò‡§ï‡§æ‡§≤‡§ø‡§ï: ‡§Ö‡§ö‡•ç‡§õ‡•Ä ‡§§‡§∞‡§π ‡§∏‡•á ‡§µ‡§ø‡§ò‡§ü‡§ø‡§§ ‡§ï‡§Æ‡•ç‡§™‡•ã‡§∏‡•ç‡§ü ‡§ú‡•ã‡§°‡§º‡•á‡§Ç ‡§î‡§∞ ‡§´‡§∏‡§≤ ‡§ö‡§ï‡•ç‡§∞‡§£ ‡§ï‡§æ ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç"
                ]
            }
        },

        defaultResponse: `üîç ‡§Æ‡•à‡§Ç ‡§∏‡§Æ‡§ù‡§§‡§æ ‡§π‡•Ç‡§Ç ‡§ï‡§ø ‡§Ü‡§™‡§ï‡•ã ‡§ï‡•É‡§∑‡§ø ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§ï‡§æ ‡§∏‡§æ‡§Æ‡§®‡§æ ‡§ï‡§∞‡§®‡§æ ‡§™‡§æ‡§π ‡§∞‡§π‡§æ ‡§π‡•à‡•§ ‡§Æ‡•Å‡§ù‡•á ‡§á‡§∏‡•á ‡§π‡§≤ ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§Æ‡§¶‡§¶ ‡§ï‡§∞‡§®‡•á ‡§¶‡•á‡§Ç!

‡§Ü‡§™‡§ï‡•ã ‡§∏‡§∞‡•ç‡§µ‡•ã‡§§‡•ç‡§§‡§Æ ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§® ‡§¶‡•á‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è, ‡§ï‡•É‡§™‡§Ø‡§æ ‡§Æ‡•Å‡§ù‡•á ‡§¨‡§§‡§æ‡§è‡§Ç:

üå± ‡§Ü‡§™ ‡§ï‡•å‡§® ‡§∏‡•Ä ‡§´‡§∏‡§≤ ‡§â‡§ó‡§æ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç?
üö® ‡§µ‡§ø‡§∂‡§ø‡§∑‡•ç‡§ü ‡§≤‡§ï‡•ç‡§∑‡§£ ‡§ú‡•ã ‡§Ü‡§™ ‡§¶‡•á‡§ñ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç?
üìÖ ‡§ï‡§ø‡§§‡§®‡•á ‡§∏‡§Æ‡§Ø ‡§∏‡•á ‡§Ø‡§π ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à?
üåßÔ∏è ‡§Ü‡§™‡§ï‡•á ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞ ‡§Æ‡•á‡§Ç ‡§π‡§æ‡§≤ ‡§ï‡•á ‡§Æ‡•å‡§∏‡§Æ ‡§ï‡•Ä ‡§∏‡•ç‡§•‡§ø‡§§‡§ø?

‡§Ø‡§æ ‡§Ö‡§™‡§®‡•Ä ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§ï‡•ã ‡§µ‡§ø‡§∏‡•ç‡§§‡§æ‡§∞ ‡§∏‡•á ‡§¨‡§§‡§æ‡§è‡§Ç ‡§ú‡•à‡§∏‡•á:
‚Ä¢ ‡§Æ‡•á‡§∞‡•á ‡§ü‡§Æ‡§æ‡§ü‡§∞ ‡§ï‡•á ‡§™‡•å‡§ß‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§™‡•Ä‡§≤‡•Ä ‡§™‡§§‡•ç‡§§‡§ø‡§Ø‡§æ‡§Ç ‡§π‡•à‡§Ç ‡§î‡§∞ ‡§Æ‡•Å‡§∞‡§ù‡§æ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç
‚Ä¢ ‡§¨‡§æ‡§∞‡§ø‡§∂ ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§Æ‡•á‡§∞‡•á ‡§ß‡§æ‡§® ‡§ï‡•á ‡§ñ‡•á‡§§ ‡§Æ‡•á‡§Ç ‡§¨‡§π‡•Å‡§§ ‡§Ö‡§ß‡§ø‡§ï ‡§™‡§æ‡§®‡•Ä ‡§π‡•à
‚Ä¢ ‡§ï‡•Ä‡§ü ‡§Æ‡•á‡§∞‡•Ä ‡§™‡§§‡•ç‡§§‡§æ‡§ó‡•ã‡§≠‡•Ä ‡§ï‡•Ä ‡§™‡§§‡•ç‡§§‡§ø‡§Ø‡§æ‡§Ç ‡§ñ‡§æ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç
‚Ä¢ ‡§Æ‡•á‡§∞‡•Ä ‡§ó‡•á‡§π‡•Ç‡§Ç ‡§ï‡•Ä ‡§´‡§∏‡§≤ ‡§†‡•Ä‡§ï ‡§∏‡•á ‡§®‡§π‡•Ä‡§Ç ‡§¨‡§¢‡§º ‡§∞‡§π‡•Ä ‡§π‡•à`
    }
};

function setLanguage(lang, e) {
    currentLanguage = lang;
    
    document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
    e.target.classList.add('active');
    
    updateHeaderText();
    updateQuickButtons();
    
    document.getElementById('userInput').placeholder = headerTexts[lang].inputPlaceholder;
    
    const chatMessages = document.getElementById('chatMessages');
    if (chatMessages.children.length === 1) {
        chatMessages.innerHTML = `<div class="message bot-message">${farmingSolutions[lang].welcome}</div>`;
    }
}

function updateHeaderText() {
    const texts = headerTexts[currentLanguage];
    document.getElementById('headerTitle').textContent = texts.title;
    document.getElementById('headerSubtitle').textContent = texts.subtitle;
    document.getElementById('headerTagline').textContent = texts.tagline;
}

function updateQuickButtons() {
    const container = document.getElementById('quickButtons');
    const buttons = farmingSolutions[currentLanguage].quickButtons;
    container.innerHTML = buttons.map(btn => 
        `<button class="quick-btn" onclick="sendQuickMessage('${btn.query}')">${btn.text}</button>`
    ).join('');
}

function sendQuickMessage(msg) {
    document.getElementById('userInput').value = msg;
    sendMessage();
}

function showTypingIndicator() {
    document.getElementById('typingIndicator').style.display = 'block';
}

function hideTypingIndicator() {
    document.getElementById('typingIndicator').style.display = 'none';
}

function addMessage(text, sender) {
    const chatMessages = document.getElementById('chatMessages');
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${sender}-message`;
    messageDiv.textContent = text;
    chatMessages.appendChild(messageDiv);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

function handleKeyPress(e) {
    if (e.key === 'Enter') sendMessage();
}

async function sendMessage() {
    const input = document.getElementById('userInput');
    const msg = input.value.trim();
    if (!msg) return;
    
    addMessage(msg, 'user');
    input.value = '';
    showTypingIndicator();

    try {
        // First try Ollama
        let response = await callOllama(msg);
        
        // If Ollama fails or not available, use local knowledge base
        if (!response) {
            response = detectProblemAndSolve(msg);
        }
        
        addMessage(response, 'bot');
    } catch (error) {
        const fallbackResponse = detectProblemAndSolve(msg);
        addMessage(fallbackResponse, 'bot');
    } finally {
        hideTypingIndicator();
    }
}

function detectProblemAndSolve(userMessage) {
    const knowledge = farmingSolutions[currentLanguage];
    const message = userMessage.toLowerCase();
    
    // Check for specific problems
    for (const [keyword, solution] of Object.entries(knowledge.problemKeywords)) {
        if (message.includes(keyword)) {
            return formatCleanSolution(solution, knowledge);
        }
    }
    
    // Check for common problem indicators
    if (message.includes('water') || message.includes('‡§™‡§æ‡§®‡•Ä')) {
        if (message.includes('too much') || message.includes('excess') || message.includes('‡§Ö‡§ß‡§ø‡§ï') || message.includes('‡§ú‡•ç‡§Ø‡§æ‡§¶‡§æ')) {
            return formatCleanSolution(knowledge.problemKeywords['waterlogging'] || knowledge.problemKeywords['‡§ú‡§≤‡§≠‡§∞‡§æ‡§µ'], knowledge);
        }
        if (message.includes('less') || message.includes('no') || message.includes('‡§ï‡§Æ') || message.includes('‡§®‡§π‡•Ä‡§Ç')) {
            return formatCleanSolution(knowledge.problemKeywords['drought'], knowledge);
        }
    }
    
    if (message.includes('yellow') || message.includes('‡§™‡•Ä‡§≤‡•Ä')) {
        return formatCleanSolution(knowledge.problemKeywords['yellow leaves'] || knowledge.problemKeywords['‡§™‡•Ä‡§≤‡•Ä ‡§™‡§§‡•ç‡§§‡§ø‡§Ø‡§æ‡§Ç'], knowledge);
    }
    
    if (message.includes('pest') || message.includes('insect') || message.includes('‡§ï‡•Ä‡§ü')) {
        return formatCleanSolution(knowledge.problemKeywords['pest attack'], knowledge);
    }
    
    if (message.includes('not growing') || message.includes('poor growth') || message.includes('‡§®‡§π‡•Ä‡§Ç ‡§¨‡§¢‡§º') || message.includes('‡§ñ‡§∞‡§æ‡§¨ ‡§µ‡§ø‡§ï‡§æ‡§∏')) {
        return formatCleanSolution(knowledge.problemKeywords['poor growth'], knowledge);
    }
    
    return knowledge.defaultResponse;
}

function formatCleanSolution(solution, knowledge) {
    let response = `üö® PROBLEM IDENTIFIED: ${solution.problem}\n\n`;
    
    if (solution.severity === "HIGH") {
        response += `‚ö†Ô∏è EMERGENCY: ${solution.warning || "Immediate action required!"}\n\n`;
    }
    
    response += `üéØ IMMEDIATE ACTION: ${solution.immediate}\n\n`;
    
    if (solution.diagnosis) {
        response += `üîç DIAGNOSIS GUIDE:\n`;
        solution.diagnosis.forEach(item => {
            response += `${item}\n`;
        });
        response += `\n`;
    }
    
    response += `üìã STEP-BY-STEP SOLUTION:\n`;
    solution.steps.forEach(step => {
        response += `${step}\n`;
    });
    
    if (solution.prevention) {
        response += `\nüõ°Ô∏è PREVENTION FOR FUTURE:\n`;
        solution.prevention.forEach(item => {
            response += `${item}\n`;
        });
    }
    
    if (solution.emergency) {
        response += `\nüöë EMERGENCY MEASURES:\n`;
        solution.emergency.forEach(item => {
            response += `${item}\n`;
        });
    }
    
    response += `\nüí° Need more specific advice? Tell me your crop type and exact symptoms!`;
    
    return response;
}

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    updateHeaderText();
    updateQuickButtons();
    checkOllama(); // Check if Ollama is running
});
</script>
</body>
</html>